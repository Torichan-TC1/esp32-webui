<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ESP32 LEDã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; }
    button { font-size: 20px; padding: 10px 20px; margin: 10px; }
  </style>
</head>
<body>
  <h1>ğŸ’¡ ESP32 LED ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h1>
  <button onclick="updateLED('on')">LED ON</button>
  <button onclick="updateLED('off')">LED OFF</button>

  <script>
    const username = "ã‚ãªãŸã®GitHubãƒ¦ãƒ¼ã‚¶ãƒ¼å";
    const repo = "esp32-control"; // ãƒªãƒã‚¸ãƒˆãƒªå
    const filename = "led_status.json";
    const token = "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";

    async function updateLED(state) {
      const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${filename}`;

      // æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®SHAã‚’å–å¾—
      const res = await fetch(apiUrl, {
        headers: {
          "Authorization": `Bearer ${token}`,
          "Accept": "application/vnd.github.v3+json"
        }
      });
      const data = await res.json();
      const sha = data.sha;

      // æ–°ã—ã„JSONã®å†…å®¹
      const newContent = btoa(JSON.stringify({ led: state }));

      // æ›´æ–°ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
      const response = await fetch(apiUrl, {
        method: "PUT",
        headers: {
          "Authorization": `Bearer ${token}`,
          "Accept": "application/vnd.github.v3+json"
        },
        body: JSON.stringify({
          message: `Set LED to ${state}`,
          content: newContent,
          sha: sha
        })
      });

      if (response.ok) {
        alert(`LEDã‚’ã€Œ${state.toUpperCase()}ã€ã«è¨­å®šã—ã¾ã—ãŸ`);
      } else {
        alert("æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ");
      }
    }
  </script>
</body>
</html>
